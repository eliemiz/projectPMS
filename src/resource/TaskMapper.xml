<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="pms.a03_dao.A12_TaskDao">
	<!-- public ArrayList<Task> getTaskList(Task sch) -->
	<resultMap type="task" id="taskList"/>
	<select id="getTaskList" resultMap="taskList" parameterType="task">
		SELECT t.*, a.name name
		FROM task t, account a
		WHERE t.account_id = a.id
	</select>
	
	<!--public Task getTask(int id) -->
	<select id="getTask" resultType="task" parameterType="int">
		SELECT t.*, a.name name
		FROM task t, account a
		WHERE t.account_id = a.id
		AND t.id = #{id}
	</select>
	
	<!-- public void insertTask(Task ins) -->
	<insert id="insertTask" parameterType="task">
		INSERT INTO TASK
		VALUES (TASK_seq.nextval, #{parent_id}, #{project_id}, #{account_id},
				#{subject}, #{description}, #{status}, #{priority}, 
				#{created_on}, #{updated_on}, #{start_date}, #{due_date},
				#{estimated}, #{done_ratio}, #{completed_on}, #{tracker})
	</insert>
	
	<!-- public void updateTask(Task upt) -->
	<update id="updateTask" parameterType="task">
		UPDATE TASK
			SET project_id = #{project_id},
				account_id = #{account_id},
				subject = #{subject},
				description = #{description},
				status = #{status},
				priority = #{priority},
				start_date = #{start_date},
				due_date = #{due_date},
				estimated = #{estimated},
				done_ratio = #{done_ratio},
				tracker = #{tracker}
			WHERE ID = #{id}
	</update>
	
	<!-- public void deleteTask(int task_id) -->
	<delete id="deleteTask" parameterType="int">
		DELETE FROM TASK
		WHERE ID in (
 	 		SELECT ID
 	 		FROM TASK
 	 		START WITH ID=#{id}
 	 		CONNECT BY PRIOR ID = PARENT_ID
 	 	) 
	</delete>
	
	<!-- public ArrayList<Task> calenList() -->
	<select id="calenList" resultMap="taskList">
		select * from task
	</select>
	
	<!-- public ArrayList<TaskResult> getTaskResult(int projectId); -->
	<select id="getTaskResult" resultType="taskResult" parameterType="int">
		SELECT T.ID, T.SUBJECT, A.NAME, T.DUE_DATE, T.COMPLETED_ON FROM TASK T, ACCOUNT A 
			WHERE T.PROJECT_ID = #{projectId} AND T.ACCOUNT_ID = A.ID AND STATUS = '완료' 
			ORDER BY COMPLETED_ON DESC;
	</select>
</mapper>


